{"title":"docker-03-Dockerfile","uid":"060e99f1c1b45532c920b0f655e0f17d","slug":"命令/docker/docker-03-Dockerfile","date":"2024-10-12T08:41:16.448Z","updated":"2024-10-19T02:30:37.363Z","comments":true,"path":"api/articles/命令/docker/docker-03-Dockerfile.json","keywords":null,"cover":"/images/cover/7.png","content":"<h1 id=\"docker-03-Dockerfile\"><a href=\"#docker-03-Dockerfile\" class=\"headerlink\" title=\"docker-03-Dockerfile\"></a>docker-03-Dockerfile</h1><ol>\n<li><p><a href=\"https://cloud.tencent.com/developer/article/1993150\">参考</a></p>\n</li>\n<li><p><a href=\"https://www.cnblogs.com/sparkdev/p/8461576.html\">关于 CMD 指令</a></p>\n <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CMD [ &quot;sh&quot;, &quot;-c&quot;, &quot;echo $HOME&quot; ] // 可以获取环境变量</span><br><span class=\"line\">CMD [ &quot;echo&quot;, &quot;$HOME&quot; ] // 无法获取环境变量</span><br></pre></td></tr></table></figure></li>\n<li><p>如要将项目打包成镜像在 docker 中运行，需要 Dockerfile 文件，其写法如下：（以 golang 项目为例）</p>\n <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FROM golang:alpine as builder</span><br><span class=\"line\"></span><br><span class=\"line\">ENV GO111MODULE=on \\</span><br><span class=\"line\">    CGO_ENABLED=0 \\</span><br><span class=\"line\">    GOOS=linux \\</span><br><span class=\"line\">    GOARCH=amd64 \\</span><br><span class=\"line\">    GOPROXY=&quot;https://goproxy.cn,direct&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">WORKDIR /app</span><br><span class=\"line\"></span><br><span class=\"line\">COPY . .</span><br><span class=\"line\"></span><br><span class=\"line\">RUN go build -o server .</span><br><span class=\"line\"></span><br><span class=\"line\">WORKDIR /dist</span><br><span class=\"line\"></span><br><span class=\"line\">RUN cp /app/server .</span><br><span class=\"line\"></span><br><span class=\"line\">EXPOSE 8090</span><br><span class=\"line\"></span><br><span class=\"line\">CMD [&quot;/dist/server&quot;]</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>构建镜像命令<br><code>docker build -t test:v1 .</code></p>\n</li>\n<li><p>多阶段构建：从上一阶段的镜像中复制文件（也可以从任意镜像复制，–from&#x3D;镜像）<br><code>COPY --from=0 /app .</code></p>\n</li>\n</ol>\n","text":"docker-03-Dockerfile 参考 关于 CMD 指令 12CMD [ \"sh\", \"-c\", \"echo $HOME\" ] // 可以获取环境变量...","permalink":"/post/命令/docker/docker-03-Dockerfile","photos":[],"count_time":{"symbolsCount":636,"symbolsTime":"1 mins."},"categories":[{"name":"命令","slug":"命令","count":15,"path":"api/categories/命令.json"}],"tags":[{"name":"技术","slug":"技术","count":168,"path":"api/tags/技术.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#docker-03-Dockerfile\"><span class=\"toc-text\">docker-03-Dockerfile</span></a></li></ol>","author":{"name":"upstreamboat","slug":"blog-author","avatar":"images/favicon/favicon.ico","link":"/","description":"nothing to say","socials":{"github":"https://github.com/upstreamboat","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"/images/favicon/bilibili.svg","link":"https://www.bilibili.com/"},"chatgpt":{"icon":"/images/favicon/chatgpt.svg","link":"https://chatgpt.com/"}}}},"mapped":true,"hidden":false,"prev_post":{"title":"docker-04-compose","uid":"7b43371a8d59a1a9537e4018c317ac7b","slug":"命令/docker/docker-04-compose","date":"2024-10-12T08:41:16.478Z","updated":"2024-10-19T02:30:42.953Z","comments":true,"path":"api/articles/命令/docker/docker-04-compose.json","keywords":null,"cover":"/images/cover/7.png","text":"docker-04-compose 参考 1 参考 2 配置 Dockerfile 1234567891011121314151617FROM golang:a...","permalink":"/post/命令/docker/docker-04-compose","photos":[],"count_time":{"symbolsCount":"1.4k","symbolsTime":"1 mins."},"categories":[{"name":"命令","slug":"命令","count":15,"path":"api/categories/命令.json"}],"tags":[{"name":"技术","slug":"技术","count":168,"path":"api/tags/技术.json"}],"author":{"name":"upstreamboat","slug":"blog-author","avatar":"images/favicon/favicon.ico","link":"/","description":"nothing to say","socials":{"github":"https://github.com/upstreamboat","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"/images/favicon/bilibili.svg","link":"https://www.bilibili.com/"},"chatgpt":{"icon":"/images/favicon/chatgpt.svg","link":"https://chatgpt.com/"}}}}},"next_post":{"title":"docker-02-更换镜像仓库","uid":"a3350072c5c3ce337874d5fb082092b7","slug":"命令/docker/docker-02-更换镜像仓库","date":"2024-10-12T08:41:16.433Z","updated":"2024-10-19T02:30:22.748Z","comments":true,"path":"api/articles/命令/docker/docker-02-更换镜像仓库.json","keywords":null,"cover":"/images/cover/7.png","text":"docker-02-更换镜像仓库golang:alpine 后面的 alpine 是镜像版本，不同版本镜像由不同底层操作系统构建成。alpine 版本有更快的启...","permalink":"/post/命令/docker/docker-02-更换镜像仓库","photos":[],"count_time":{"symbolsCount":"1k","symbolsTime":"1 mins."},"categories":[{"name":"命令","slug":"命令","count":15,"path":"api/categories/命令.json"}],"tags":[{"name":"技术","slug":"技术","count":168,"path":"api/tags/技术.json"}],"author":{"name":"upstreamboat","slug":"blog-author","avatar":"images/favicon/favicon.ico","link":"/","description":"nothing to say","socials":{"github":"https://github.com/upstreamboat","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"/images/favicon/bilibili.svg","link":"https://www.bilibili.com/"},"chatgpt":{"icon":"/images/favicon/chatgpt.svg","link":"https://chatgpt.com/"}}}}}}