{"title":"库--local_cache","uid":"138178ff8fefae8d453b88a44dba3762","slug":"GO语言/运用/库--local_cache","date":"2024-10-12T02:28:09.201Z","updated":"2024-10-19T08:25:52.518Z","comments":true,"path":"api/articles/GO语言/运用/库--local_cache.json","keywords":null,"cover":"/images/cover/5.png","content":"<h1 id=\"库–local-cache\"><a href=\"#库–local-cache\" class=\"headerlink\" title=\"库–local_cache\"></a>库–local_cache</h1><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&quot;github.com/songzhibin97/gkit/cache/local_cache&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">Test071904</span><span class=\"params\">(t *testing.T)</span></span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// local_cache.Cache是一个可以存储k、v及其过期时间的对象</span></span><br><span class=\"line\"></span><br><span class=\"line\">ch := local_cache.NewCache(</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 设置自动检测是否过期的间隔时间</span></span><br><span class=\"line\"></span><br><span class=\"line\">local_cache.SetInternal(<span class=\"number\">6</span>*time.Second),</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 设置默认过期时间</span></span><br><span class=\"line\"></span><br><span class=\"line\">local_cache.SetDefaultExpire(<span class=\"number\">100</span>*time.Second),</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 当key被删除时，调用该函数</span></span><br><span class=\"line\"></span><br><span class=\"line\">local_cache.SetCapture(<span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(k <span class=\"type\">string</span>, v <span class=\"keyword\">interface</span>&#123;&#125;)</span></span> &#123; log.Println(k, v) &#125;),</span><br><span class=\"line\"></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 添加k、v、过期时间</span></span><br><span class=\"line\"></span><br><span class=\"line\">ch.Add(<span class=\"string\">&quot;haha&quot;</span>, <span class=\"string\">&quot;dd&quot;</span>, <span class=\"number\">10</span>*time.Second)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 根据k获取v</span></span><br><span class=\"line\"></span><br><span class=\"line\">t.Log(ch.Get(<span class=\"string\">&quot;haha&quot;</span>)) <span class=\"comment\">// 如果k已过期，但又尚未被自动删除，调用Get会返回nil并删除k</span></span><br><span class=\"line\"></span><br><span class=\"line\">time.Sleep(<span class=\"number\">11</span> * time.Second)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 当过期自动删除后，再次获取便是nil了</span></span><br><span class=\"line\"></span><br><span class=\"line\">t.Log(ch.Get(<span class=\"string\">&quot;haha&quot;</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<div class=\"language-txt\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">txt</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #292D3E\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #babed8\">别人发布的库，可以看下原码</span></span></code></pre></div></blockquote>\n","text":"库–local_cache12345678910111213141516171819202122232425262728293031323334353637im...","permalink":"/post/GO语言/运用/库--local_cache","photos":[],"count_time":{"symbolsCount":725,"symbolsTime":"1 mins."},"categories":[{"name":"GO语言","slug":"GO语言","count":77,"path":"api/categories/GO语言.json"}],"tags":[{"name":"技术","slug":"技术","count":168,"path":"api/tags/技术.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%BA%93%E2%80%93local-cache\"><span class=\"toc-text\">库–local_cache</span></a></li></ol>","author":{"name":"upstreamboat","slug":"blog-author","avatar":"images/favicon/favicon.ico","link":"/","description":"nothing to say","socials":{"github":"https://github.com/upstreamboat","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"/images/favicon/bilibili.svg","link":"https://www.bilibili.com/"},"chatgpt":{"icon":"/images/favicon/chatgpt.svg","link":"https://chatgpt.com/"}}}},"mapped":true,"hidden":false,"prev_post":{"title":"http使用代理","uid":"cc48c84a0b269510bff4cfddc4b4c58f","slug":"GO语言/运用/http使用代理","date":"2024-10-12T02:28:09.228Z","updated":"2024-10-19T08:25:54.383Z","comments":true,"path":"api/articles/GO语言/运用/http使用代理.json","keywords":null,"cover":"/images/cover/5.png","text":"http 使用代理学习 http1.1 使用代理： 123456789101112131415161718192021222324252627282930313...","permalink":"/post/GO语言/运用/http使用代理","photos":[],"count_time":{"symbolsCount":"1.4k","symbolsTime":"1 mins."},"categories":[{"name":"GO语言","slug":"GO语言","count":77,"path":"api/categories/GO语言.json"}],"tags":[{"name":"技术","slug":"技术","count":168,"path":"api/tags/技术.json"}],"author":{"name":"upstreamboat","slug":"blog-author","avatar":"images/favicon/favicon.ico","link":"/","description":"nothing to say","socials":{"github":"https://github.com/upstreamboat","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"/images/favicon/bilibili.svg","link":"https://www.bilibili.com/"},"chatgpt":{"icon":"/images/favicon/chatgpt.svg","link":"https://chatgpt.com/"}}}}},"next_post":{"title":"库--rand","uid":"0363533ce4954d4e525c36bb03abdb08","slug":"GO语言/运用/库--rand","date":"2024-10-12T02:28:09.181Z","updated":"2024-10-19T08:25:48.926Z","comments":true,"path":"api/articles/GO语言/运用/库--rand.json","keywords":null,"cover":"/images/cover/5.png","text":"库–rand使用有种子的随机数，不可以放在循环内部，否则 1s 内产生的数是一样的 12345678910111213141516171819202122232...","permalink":"/post/GO语言/运用/库--rand","photos":[],"count_time":{"symbolsCount":933,"symbolsTime":"1 mins."},"categories":[{"name":"GO语言","slug":"GO语言","count":77,"path":"api/categories/GO语言.json"}],"tags":[{"name":"技术","slug":"技术","count":168,"path":"api/tags/技术.json"}],"author":{"name":"upstreamboat","slug":"blog-author","avatar":"images/favicon/favicon.ico","link":"/","description":"nothing to say","socials":{"github":"https://github.com/upstreamboat","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"/images/favicon/bilibili.svg","link":"https://www.bilibili.com/"},"chatgpt":{"icon":"/images/favicon/chatgpt.svg","link":"https://chatgpt.com/"}}}}}}