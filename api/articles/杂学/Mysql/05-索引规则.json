{"title":"05-索引规则","uid":"c0b9ae6ffec5bc9b2d5caca7dc32deb0","slug":"杂学/Mysql/05-索引规则","date":"2024-10-11T01:50:26.342Z","updated":"2024-10-19T08:22:38.364Z","comments":true,"path":"api/articles/杂学/Mysql/05-索引规则.json","keywords":null,"cover":"/images/cover/2.png","content":"<h1 id=\"索引使用规则\"><a href=\"#索引使用规则\" class=\"headerlink\" title=\"索引使用规则\"></a>索引使用规则</h1><p>现有联合索引 idx_ename_deptno_comm，索引字段顺序为 ename、deptno、comm</p>\n<h3 id=\"1-最左前缀\"><a href=\"#1-最左前缀\" class=\"headerlink\" title=\"1. 最左前缀\"></a>1. 最左前缀</h3><p>查询时，如索引第一个字段(ename)不存在，则不走索引；如存在跳过字段情况，则被跳过字段(deptno)之后的字段(comm)不走索引。</p>\n<ul>\n<li><p>正常情况（where 后的条件顺序无关）</p>\n  <figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">desc</span> <span class=\"keyword\">SELECT</span> \\<span class=\"operator\">*</span> <span class=\"keyword\">from</span> emp <span class=\"keyword\">where</span> ename<span class=\"operator\">=</span><span class=\"string\">&#x27;WJEWTE&#x27;</span>; <span class=\"comment\">-- 走索引，索引长度 83</span></span><br><span class=\"line\"><span class=\"keyword\">desc</span> <span class=\"keyword\">SELECT</span> \\<span class=\"operator\">*</span> <span class=\"keyword\">from</span> emp <span class=\"keyword\">where</span> ename<span class=\"operator\">=</span><span class=\"string\">&#x27;WJEWTE&#x27;</span> <span class=\"keyword\">and</span> deptno<span class=\"operator\">=</span><span class=\"number\">3</span>; <span class=\"comment\">-- 走索引，索引长度 88</span></span><br><span class=\"line\"><span class=\"keyword\">desc</span> <span class=\"keyword\">SELECT</span> \\<span class=\"operator\">*</span> <span class=\"keyword\">from</span> emp <span class=\"keyword\">where</span> ename<span class=\"operator\">=</span><span class=\"string\">&#x27;WJEWTE&#x27;</span> <span class=\"keyword\">and</span> deptno<span class=\"operator\">=</span><span class=\"number\">3</span> <span class=\"keyword\">and</span> comm<span class=\"operator\">=</span><span class=\"number\">400</span>; <span class=\"comment\">-- 走索引，索引长度 93</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>异常情况</p>\n  <figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">desc</span> <span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> emp <span class=\"keyword\">where</span> ename<span class=\"operator\">=</span><span class=\"string\">&#x27;WJEWTE&#x27;</span> <span class=\"keyword\">and</span> comm<span class=\"operator\">=</span><span class=\"number\">400</span>; <span class=\"comment\">-- 走索引，索引长度83，说明只有ename走了索引，comm没有走</span></span><br><span class=\"line\"><span class=\"keyword\">desc</span> <span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> emp <span class=\"keyword\">where</span> deptno<span class=\"operator\">=</span><span class=\"number\">3</span> <span class=\"keyword\">and</span> comm<span class=\"operator\">=</span><span class=\"number\">400</span>; <span class=\"comment\">-- 不走索引，因为缺少最左前缀字段ename</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"2、范围查询（）\"><a href=\"#2、范围查询（）\" class=\"headerlink\" title=\"2、范围查询（&lt;,&gt;）\"></a>2、范围查询（&lt;,&gt;）</h3><p>当使用&gt;或&lt;时，会使其右侧不走索引</p>\n<ul>\n<li><p>正常情况</p>\n  <figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">desc</span> <span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> emp <span class=\"keyword\">where</span> ename<span class=\"operator\">=</span><span class=\"string\">&#x27;WJEWTE&#x27;</span> <span class=\"keyword\">and</span> deptno<span class=\"operator\">&gt;</span><span class=\"number\">3</span>; <span class=\"comment\">-- 走索引，索引长度88</span></span><br><span class=\"line\"><span class=\"keyword\">desc</span> <span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> emp <span class=\"keyword\">where</span> ename<span class=\"operator\">=</span><span class=\"string\">&#x27;WJEWTE&#x27;</span> <span class=\"keyword\">and</span> deptno<span class=\"operator\">&gt;=</span><span class=\"number\">3</span> <span class=\"keyword\">and</span> comm<span class=\"operator\">=</span><span class=\"number\">400</span>; <span class=\"comment\">-- 走索引，索引长度93</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>异常情况</p>\n  <figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">desc</span> <span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> emp <span class=\"keyword\">where</span> ename<span class=\"operator\">=</span><span class=\"string\">&#x27;WJEWTE&#x27;</span> <span class=\"keyword\">and</span> deptno<span class=\"operator\">&gt;</span><span class=\"number\">3</span> <span class=\"keyword\">and</span> comm<span class=\"operator\">=</span><span class=\"number\">400</span>; <span class=\"comment\">-- 走索引，索引长度88，说明comm没有走</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"3-索引列运算\"><a href=\"#3-索引列运算\" class=\"headerlink\" title=\"3. 索引列运算\"></a>3. 索引列运算</h3><p>对索引字段进行运算时，会不走索引</p>\n<ul>\n<li><p>异常情况</p>\n  <figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">desc</span> <span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> emp <span class=\"keyword\">where</span> SUBSTR(ename,<span class=\"number\">4</span>,<span class=\"number\">3</span>)<span class=\"operator\">=</span><span class=\"string\">&#x27;WTE&#x27;</span>; <span class=\"comment\">-- 不走索引</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"4-字符串不加引号\"><a href=\"#4-字符串不加引号\" class=\"headerlink\" title=\"4. 字符串不加引号\"></a>4. 字符串不加引号</h3><p>字符串类型的表字段存储数字时，虽然不加引号能查出来，但不走索引</p>\n<ul>\n<li>正常情况  <figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">desc</span> <span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> emp <span class=\"keyword\">where</span> ename <span class=\"operator\">=</span> <span class=\"string\">&#x27;111&#x27;</span> ; <span class=\"comment\">-- 走索引</span></span><br></pre></td></tr></table></figure></li>\n<li>异常情况  <figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">desc</span> <span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> emp <span class=\"keyword\">where</span> ename <span class=\"operator\">=</span> <span class=\"number\">111</span> ; <span class=\"comment\">-- 不走索引</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"5-模糊匹配\"><a href=\"#5-模糊匹配\" class=\"headerlink\" title=\"5. 模糊匹配\"></a>5. 模糊匹配</h3><p>最左侧有%时，不走索引</p>\n<ul>\n<li>正常情况  <figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">desc</span> <span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> emp <span class=\"keyword\">where</span> ename <span class=\"keyword\">like</span> <span class=\"string\">&#x27;WJ%WT%&#x27;</span> ; <span class=\"comment\">-- 走索引</span></span><br></pre></td></tr></table></figure></li>\n<li>异常情况  <figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">desc</span> <span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> emp <span class=\"keyword\">where</span> ename <span class=\"keyword\">like</span> <span class=\"string\">&#x27;%JEWT%&#x27;</span> ; <span class=\"comment\">-- 不走索引</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"6-or-连接\"><a href=\"#6-or-连接\" class=\"headerlink\" title=\"6. or 连接\"></a>6. or 连接</h3><p>只要有一边不走索引，则整个都不走索引</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">desc</span> <span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> emp <span class=\"keyword\">where</span> deptno<span class=\"operator\">=</span><span class=\"number\">3</span> <span class=\"keyword\">or</span> comm<span class=\"operator\">=</span><span class=\"number\">300</span> ;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"7-特殊情况\"><a href=\"#7-特殊情况\" class=\"headerlink\" title=\"7. 特殊情况\"></a>7. 特殊情况</h3><p>根据数据分布，mysql 会自动优化是否选择索引</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">desc</span> <span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> dept <span class=\"keyword\">where</span> deptno<span class=\"operator\">&gt;</span><span class=\"number\">9</span>; <span class=\"comment\">-- dept&gt;9的数据超过了总数据量的一半，直接全表扫描，不走索引</span></span><br><span class=\"line\"><span class=\"keyword\">desc</span> <span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> dept <span class=\"keyword\">where</span> deptno<span class=\"operator\">&gt;</span><span class=\"number\">10</span>; <span class=\"comment\">-- dept&gt;10的数据不到一半，又走了索引</span></span><br><span class=\"line\"><span class=\"comment\">-- 这里的一半，只是预估值；还有，即使查询数据占了总数据量的绝大多数，也未必就一定不走索引的，不知道为什么</span></span><br><span class=\"line\"><span class=\"keyword\">desc</span> <span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> emp <span class=\"keyword\">where</span> comm<span class=\"operator\">=</span><span class=\"number\">400</span> ; <span class=\"comment\">-- 500万条数据只有一条不是comm=400，但还是走了索引，不知道为什么</span></span><br></pre></td></tr></table></figure>\n","text":"索引使用规则现有联合索引 idx_ename_deptno_comm，索引字段顺序为 ename、deptno、comm 1. 最左前缀查询时，如索引第一个字段...","permalink":"/post/杂学/Mysql/05-索引规则","photos":[],"count_time":{"symbolsCount":"1.8k","symbolsTime":"2 mins."},"categories":[{"name":"Mysql","slug":"Mysql","count":6,"path":"api/categories/Mysql.json"}],"tags":[{"name":"技术","slug":"技术","count":168,"path":"api/tags/技术.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E7%B4%A2%E5%BC%95%E4%BD%BF%E7%94%A8%E8%A7%84%E5%88%99\"><span class=\"toc-text\">索引使用规则</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#1-%E6%9C%80%E5%B7%A6%E5%89%8D%E7%BC%80\"><span class=\"toc-text\">1. 最左前缀</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#2%E3%80%81%E8%8C%83%E5%9B%B4%E6%9F%A5%E8%AF%A2%EF%BC%88%EF%BC%89\"><span class=\"toc-text\">2、范围查询（&lt;,&gt;）</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#3-%E7%B4%A2%E5%BC%95%E5%88%97%E8%BF%90%E7%AE%97\"><span class=\"toc-text\">3. 索引列运算</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#4-%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%8D%E5%8A%A0%E5%BC%95%E5%8F%B7\"><span class=\"toc-text\">4. 字符串不加引号</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#5-%E6%A8%A1%E7%B3%8A%E5%8C%B9%E9%85%8D\"><span class=\"toc-text\">5. 模糊匹配</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#6-or-%E8%BF%9E%E6%8E%A5\"><span class=\"toc-text\">6. or 连接</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#7-%E7%89%B9%E6%AE%8A%E6%83%85%E5%86%B5\"><span class=\"toc-text\">7. 特殊情况</span></a></li></ol></li></ol></li></ol>","author":{"name":"upstreamboat","slug":"blog-author","avatar":"images/favicon/favicon.ico","link":"/","description":"nothing to say","socials":{"github":"https://github.com/upstreamboat","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"/images/favicon/bilibili.svg","link":"https://www.bilibili.com/"},"chatgpt":{"icon":"/images/favicon/chatgpt.svg","link":"https://chatgpt.com/"}}}},"mapped":true,"hidden":false,"prev_post":{"title":"06-知识点","uid":"66e57a4409ad22c1322b5d5381bb37e5","slug":"杂学/Mysql/06-知识点","date":"2024-10-11T02:06:20.576Z","updated":"2024-10-19T08:22:41.229Z","comments":true,"path":"api/articles/杂学/Mysql/06-知识点.json","keywords":null,"cover":"/images/cover/2.png","text":" 外键对应的必须是唯一性索引。比如主键、unique 定义的字段 ","permalink":"/post/杂学/Mysql/06-知识点","photos":[],"count_time":{"symbolsCount":34,"symbolsTime":"1 mins."},"categories":[{"name":"Mysql","slug":"Mysql","count":6,"path":"api/categories/Mysql.json"}],"tags":[{"name":"技术","slug":"技术","count":168,"path":"api/tags/技术.json"}],"author":{"name":"upstreamboat","slug":"blog-author","avatar":"images/favicon/favicon.ico","link":"/","description":"nothing to say","socials":{"github":"https://github.com/upstreamboat","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"/images/favicon/bilibili.svg","link":"https://www.bilibili.com/"},"chatgpt":{"icon":"/images/favicon/chatgpt.svg","link":"https://chatgpt.com/"}}}}},"next_post":{"title":"04-索引","uid":"d837ac5d90753ab8aaca1b36dc2bf2da","slug":"杂学/Mysql/04-索引","date":"2024-10-11T01:12:20.673Z","updated":"2024-10-19T08:22:36.362Z","comments":true,"path":"api/articles/杂学/Mysql/04-索引.json","keywords":null,"cover":"/images/cover/2.png","text":"索引分类聚集索引 自动生成，有且仅有一个 1）根据主键自动生成2）主键不存在，根据唯一索引自动生成3）都不存在，生成一个隐藏的聚集索引（无法查看） 叶子节点中的...","permalink":"/post/杂学/Mysql/04-索引","photos":[],"count_time":{"symbolsCount":"1.3k","symbolsTime":"1 mins."},"categories":[{"name":"Mysql","slug":"Mysql","count":6,"path":"api/categories/Mysql.json"}],"tags":[{"name":"技术","slug":"技术","count":168,"path":"api/tags/技术.json"}],"author":{"name":"upstreamboat","slug":"blog-author","avatar":"images/favicon/favicon.ico","link":"/","description":"nothing to say","socials":{"github":"https://github.com/upstreamboat","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"/images/favicon/bilibili.svg","link":"https://www.bilibili.com/"},"chatgpt":{"icon":"/images/favicon/chatgpt.svg","link":"https://chatgpt.com/"}}}}}}