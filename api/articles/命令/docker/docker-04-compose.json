{"title":"docker-04-compose","uid":"7b43371a8d59a1a9537e4018c317ac7b","slug":"命令/docker/docker-04-compose","date":"2024-10-12T08:41:16.478Z","updated":"2024-10-19T02:30:42.953Z","comments":true,"path":"api/articles/命令/docker/docker-04-compose.json","keywords":null,"cover":"/images/cover/7.png","content":"<h1 id=\"docker-04-compose\"><a href=\"#docker-04-compose\" class=\"headerlink\" title=\"docker-04-compose\"></a>docker-04-compose</h1><ol>\n<li><p><a href=\"https://blog.csdn.net/pushiqiang/article/details/78682323\">参考 1</a></p>\n</li>\n<li><p><a href=\"https://cloud.tencent.com/developer/article/1993150\">参考 2</a></p>\n</li>\n<li><p>配置 Dockerfile</p>\n <figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FROM golang:alpine as builder</span><br><span class=\"line\"></span><br><span class=\"line\">ENV GO111MODULE=on \\</span><br><span class=\"line\">    CGO_ENABLED=<span class=\"number\">0</span> \\</span><br><span class=\"line\">    GOOS=linux \\</span><br><span class=\"line\">    GOARCH=amd64 \\</span><br><span class=\"line\">    GOPROXY=<span class=\"string\">&quot;https://goproxy.cn,direct&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">WORKDIR /</span><br><span class=\"line\"></span><br><span class=\"line\">COPY . .</span><br><span class=\"line\"></span><br><span class=\"line\">RUN <span class=\"keyword\">go</span> build -o server .</span><br><span class=\"line\"></span><br><span class=\"line\">EXPOSE <span class=\"number\">8090</span></span><br><span class=\"line\"></span><br><span class=\"line\">CMD [<span class=\"string\">&quot;./server&quot;</span>]</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>配置 docker-compose.yml</p>\n <figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">version:</span> <span class=\"string\">&quot;3.7&quot;</span></span><br><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">  <span class=\"attr\">app:</span></span><br><span class=\"line\">    <span class=\"attr\">build:</span></span><br><span class=\"line\">      <span class=\"attr\">context:</span> <span class=\"string\">./</span> <span class=\"comment\"># 要构建的程序代码目录</span></span><br><span class=\"line\">      <span class=\"attr\">dockerfile:</span> <span class=\"string\">./Dockerfile</span> <span class=\"comment\"># 指定Dockerfile所在位置，相对路径为context配置的路径</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">8088</span><span class=\"string\">:8888</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">./data:/app/data</span>  <span class=\"comment\"># 宿主机当前目录下的/data目录映射到容器中</span></span><br><span class=\"line\">    <span class=\"attr\">depends_on:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">redis</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">mysql</span></span><br><span class=\"line\">    <span class=\"attr\">restart:</span> <span class=\"string\">on-failure</span>  <span class=\"comment\"># 失败重启，避免mysql未启动完全，app便启动可能带来的报错</span></span><br><span class=\"line\">    <span class=\"attr\">links:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">redis</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">mysql</span></span><br><span class=\"line\">  <span class=\"attr\">redis:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">redis</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">D:\\Doc\\DockerMounts\\redis:/data</span>  <span class=\"comment\"># 容器内的data目录挂载到宿主机的D:\\Doc\\DockerMounts\\redis</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;6379:6379&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">mysql:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">mysql</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&quot;3306:3306&quot;</span>  <span class=\"comment\"># host物理直接映射端口为3306</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"attr\">MYSQL_DATABASE:</span> <span class=\"string\">&#x27;test&#x27;</span> <span class=\"comment\"># 初始化启动时要创建的数据库的名称</span></span><br><span class=\"line\">      <span class=\"attr\">MYSQL_ROOT_PASSWORD:</span> <span class=\"string\">&quot;root&quot;</span> <span class=\"comment\"># root管理员用户密码</span></span><br><span class=\"line\"><span class=\"attr\">volumes:</span></span><br><span class=\"line\">  <span class=\"attr\">redis:</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>修改应用的连接配置<br>host 必须配成 redis，不能是 127.0.0.1；mysql 也是同理</p>\n <figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">redis:</span></span><br><span class=\"line\">  <span class=\"attr\">host:</span> <span class=\"string\">redis</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">6379</span></span><br><span class=\"line\">  <span class=\"attr\">db:</span> <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"attr\">password:</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>启动：在 docker-compose.yml 目录下执行命令：<br><code>docker-compose up</code> &#x2F;&#x2F; 如果是 linux：则是：<code>docker compose up</code><br>成功后会创建一个镜像，并自动创建运行一个容器组</p>\n</li>\n</ol>\n","text":"docker-04-compose 参考 1 参考 2 配置 Dockerfile 1234567891011121314151617FROM golang:a...","permalink":"/post/命令/docker/docker-04-compose","photos":[],"count_time":{"symbolsCount":"1.4k","symbolsTime":"1 mins."},"categories":[{"name":"命令","slug":"命令","count":15,"path":"api/categories/命令.json"}],"tags":[{"name":"技术","slug":"技术","count":158,"path":"api/tags/技术.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#docker-04-compose\"><span class=\"toc-text\">docker-04-compose</span></a></li></ol>","author":{"name":"upstreamboat","slug":"blog-author","avatar":"images/favicon/favicon_2.jfif","link":"/","description":"nothing to say","socials":{"github":"https://github.com/upstreamboat","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"/images/favicon/bilibili.svg","link":"https://www.bilibili.com/"},"chatgpt":{"icon":"/images/favicon/chatgpt.svg","link":"https://chatgpt.com/"}}}},"mapped":true,"hidden":false,"prev_post":{"title":"docker-05-volume","uid":"d1606efea8d5cfe2a8c493a980499133","slug":"命令/docker/docker-05-volume","date":"2024-10-12T08:41:16.500Z","updated":"2024-10-19T02:30:48.004Z","comments":true,"path":"api/articles/命令/docker/docker-05-volume.json","keywords":null,"cover":"/images/cover/7.png","text":"docker-05-volume 参考 参考 参考 参考 使用方式： 启动容器时：docker run -v /A:/B 将宿主机的/A 目录挂载到容器内的/B...","permalink":"/post/命令/docker/docker-05-volume","photos":[],"count_time":{"symbolsCount":587,"symbolsTime":"1 mins."},"categories":[{"name":"命令","slug":"命令","count":15,"path":"api/categories/命令.json"}],"tags":[{"name":"技术","slug":"技术","count":158,"path":"api/tags/技术.json"}],"author":{"name":"upstreamboat","slug":"blog-author","avatar":"images/favicon/favicon_2.jfif","link":"/","description":"nothing to say","socials":{"github":"https://github.com/upstreamboat","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"/images/favicon/bilibili.svg","link":"https://www.bilibili.com/"},"chatgpt":{"icon":"/images/favicon/chatgpt.svg","link":"https://chatgpt.com/"}}}}},"next_post":{"title":"docker-03-Dockerfile","uid":"060e99f1c1b45532c920b0f655e0f17d","slug":"命令/docker/docker-03-Dockerfile","date":"2024-10-12T08:41:16.448Z","updated":"2024-10-19T02:30:37.363Z","comments":true,"path":"api/articles/命令/docker/docker-03-Dockerfile.json","keywords":null,"cover":"/images/cover/7.png","text":"docker-03-Dockerfile 参考 关于 CMD 指令 12CMD [ \"sh\", \"-c\", \"echo $HOME\" ] // 可以获取环境变量...","permalink":"/post/命令/docker/docker-03-Dockerfile","photos":[],"count_time":{"symbolsCount":636,"symbolsTime":"1 mins."},"categories":[{"name":"命令","slug":"命令","count":15,"path":"api/categories/命令.json"}],"tags":[{"name":"技术","slug":"技术","count":158,"path":"api/tags/技术.json"}],"author":{"name":"upstreamboat","slug":"blog-author","avatar":"images/favicon/favicon_2.jfif","link":"/","description":"nothing to say","socials":{"github":"https://github.com/upstreamboat","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"/images/favicon/bilibili.svg","link":"https://www.bilibili.com/"},"chatgpt":{"icon":"/images/favicon/chatgpt.svg","link":"https://chatgpt.com/"}}}}}}